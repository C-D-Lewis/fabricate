<!DOCTYPE html>
<html>
  <head>
    <title>fabricate.js example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
      * { font-family: sans-serif; }
      html, body { margin: 0; padding: 0; }
    </style>
  </head>
  <body>
    <script type="text/javascript" src="../../fabricate.js"></script>

    <script>
      /**
       * Login form with email, password, and submit button.
       * 
       * @returns {HTMLElement}
       */
      const LoginForm = () => fabricate('div')
        .setChildren([
          fab('TextInput', { placeholder: 'Email' })
            .setStyles({ margin: 'auto' })
            .onChange((el, state, value) => fab.update({ email: value })),
          fab('TextInput', { placeholder: 'Password' })
            .setStyles({ margin: 'auto' })
            .setAttributes({ type: 'password' })
            .onChange((el, state, value) => fab.update({ password: value })),

          fab('Button', { text: 'Submit' })
            .setStyles({ margin: '15px auto' })
            .onClick((el, state) => {
              if (!state.email || !state.password) {
                alert('Please enter your details');
                return;
              }

              // Mock login
              fab.update({ isLoading: true });
              setTimeout(() => {
                fab.update({ isLoading: false });
                fab.update({ isCompleted: true });
              }, 3000);
            }),
        ]);

      /**
       * Login box with title, image, LoginForm and Loader.
       * 
       * @returns {HTMLElement}
       */
      const LoginBox = () => fab('Card')
        .setStyles({
          minWidth: '420px',
          minHeight: '300px',
          margin: 'auto',
          textAlign: 'center',
        })
        .setChildren([
          fab('Text')
            .setText('Login')
            .setStyles({ fontWeight: 'bold', fontSize: '1.5rem' }),
          fab('Image', {
            src: '../assets/account.png',
            width: '100px',
            height: '100px',
          })
            .setStyles({ margin: '5px auto' }),

          fab.when(state => !state.isLoading, () => LoginForm()),
          fab.when(
            state => state.isLoading && !state.isCompleted,
            () => fab('Loader').setStyles({ margin: '20px auto' }),
          ),
        ]);

      const App = () => fab('Column')
        .setStyles({ padding: '40px' })
        .setChildren([
          fab.when(state => !state.isCompleted, () => fab('Fader').setChildren([LoginBox()])),
          fab.when(state => state.isCompleted, () => fab('Text').setText('Login completed!')),
        ]);

      const initialState = {
        email: undefined,
        password: undefined,
        isLoading: false,
        isCompleted: false,
      };
      fabricate.app(App(), initialState);
    </script>
  </body>
</html>
